<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 12 - Vocabulary Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            margin: 0; 
            overflow-x: hidden;
            background-image: url('https://img.freepik.com/free-vector/flat-design-english-school-background_23-2149487419.jpg?w=2000');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
            transition: background 0.5s ease;
        }
        .hidden { display: none !important; }
        #app {
            background: rgba(2, 6, 23, 0.85);
            backdrop-filter: blur(4px);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .fever-mode #app {
            background: rgba(79, 70, 229, 0.6);
            box-shadow: inset 0 0 100px rgba(255, 255, 255, 0.2);
        }
        .glow { box-shadow: 0 0 25px rgba(79, 70, 229, 0.5); }
        .card { 
            background: rgba(15, 23, 42, 0.9); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(255,255,255,0.15); 
            border-radius: 2rem; 
        }
        .unit-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .unit-card:not(.locked):hover {
            background: rgba(79, 70, 229, 0.2);
            border-color: #4f46e5;
            transform: translateY(-5px);
        }
        .locked { opacity: 0.5; cursor: not-allowed; }
        .btn-opt { 
            background: rgba(255,255,255,0.08); 
            border: 1px solid rgba(255,255,255,0.15); 
            padding: 1.25rem; 
            border-radius: 1rem; 
            transition: all 0.2s; 
            font-weight: 800; 
            font-size: 1.1rem; 
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        .btn-opt:hover { 
            background: white; 
            color: #4f46e5; 
            transform: scale(1.02); 
        }
        .animate-pop { animation: pop 0.3s ease-out; }
        @keyframes pop { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .heart { color: #ef4444; filter: drop-shadow(0 0 5px rgba(239, 68, 68, 0.5)); }
        
        .status-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
            pointer-events: none;
            text-align: center;
            width: 100%;
        }
    </style>
</head>
<body>
    <div id="app" class="p-6 relative">
        <div id="status-overlay" class="status-overlay hidden">
            <h2 id="status-text" class="text-5xl font-black italic uppercase tracking-tighter drop-shadow-2xl">MESSAGE</h2>
        </div>

        <div id="view-landing" class="relative z-10 text-center w-full max-w-md animate-pop">
            <div class="w-20 h-20 bg-indigo-600 rounded-[2rem] flex items-center justify-center mx-auto mb-8 glow">
                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="m16 6 4 14H4L8 6Z"/><path d="M12 2v4"/><path d="m8 2 1 1"/><path d="m16 2-1 1"/></svg>
            </div>
            <h1 class="text-4xl font-black mb-2 tracking-tighter uppercase italic text-white drop-shadow-lg">Grade 12</h1>
            <h2 class="text-2xl font-bold mb-4 text-indigo-300">Vocabulary Master</h2>
            
            <div id="best-score-container" class="mb-8 hidden">
                <p class="text-[10px] font-black uppercase tracking-[0.3em] text-slate-400">K·ª∑ l·ª•c c√° nh√¢n</p>
                <p id="best-score-display" class="text-2xl font-black text-yellow-400">0</p>
            </div>

            <button onclick="showUnitSelection()" class="w-full bg-white text-indigo-700 py-5 rounded-2xl font-black text-lg hover:bg-indigo-600 hover:text-white transition-all shadow-2xl">B·∫ÆT ƒê·∫¶U</button>
        </div>

        <div id="view-selection" class="relative z-10 w-full max-w-2xl hidden animate-pop">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-black uppercase tracking-tighter">Ch·ªçn b√†i h·ªçc</h2>
                <p class="text-indigo-300 text-sm font-bold uppercase tracking-widest mt-2">English 12 - Global Success</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div onclick="selectUnit(5)" class="unit-card p-8 rounded-[2rem] cursor-pointer flex flex-col justify-between h-full">
                    <div>
                        <span class="bg-green-500/20 text-green-400 text-[10px] font-black px-3 py-1 rounded-full uppercase tracking-widest">S·∫µn s√†ng</span>
                        <h3 class="text-2xl font-black mt-4 uppercase tracking-tighter text-white">Unit 5</h3>
                        <p class="text-slate-400 text-sm mt-1">Urbanization</p>
                    </div>
                    <div class="mt-10 flex items-center justify-between">
                        <span class="text-xs font-bold text-indigo-400 uppercase tracking-widest">130+ T·ª´ v·ª±ng</span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="text-indigo-400"><path d="m9 18 6-6-6-6"/></svg>
                    </div>
                </div>
                <div class="unit-card locked p-8 rounded-[2rem] relative overflow-hidden">
                    <div class="absolute inset-0 bg-slate-950/40 flex items-center justify-center backdrop-blur-[1px]">
                        <span class="bg-slate-800 text-slate-400 text-[10px] font-black px-4 py-2 rounded-full uppercase tracking-widest border border-white/5">Coming soon</span>
                    </div>
                    <h3 class="text-2xl font-black mt-4 uppercase tracking-tighter">Unit 6</h3>
                    <p class="text-slate-400 text-sm mt-1">Endangered Species</p>
                </div>
                <div class="unit-card locked p-8 rounded-[2rem] relative overflow-hidden">
                    <div class="absolute inset-0 bg-slate-950/40 flex items-center justify-center backdrop-blur-[1px]">
                        <span class="bg-slate-800 text-slate-400 text-[10px] font-black px-4 py-2 rounded-full uppercase tracking-widest border border-white/5">Coming soon</span>
                    </div>
                    <h3 class="text-2xl font-black mt-4 uppercase tracking-tighter">Unit 7</h3>
                    <p class="text-slate-400 text-sm mt-1">Artificial Intelligence</p>
                </div>
                <div class="unit-card locked p-8 rounded-[2rem] relative overflow-hidden">
                    <div class="absolute inset-0 bg-slate-950/40 flex items-center justify-center backdrop-blur-[1px]">
                        <span class="bg-slate-800 text-slate-400 text-[10px] font-black px-4 py-2 rounded-full uppercase tracking-widest border border-white/5">Coming soon</span>
                    </div>
                    <h3 class="text-2xl font-black mt-4 uppercase tracking-tighter">Unit 8</h3>
                    <p class="text-slate-400 text-sm mt-1">The World of Work</p>
                </div>
            </div>
            <button onclick="location.reload()" class="mt-12 text-slate-400 text-xs font-black uppercase tracking-[0.2em] hover:text-white transition-colors block mx-auto underline">Quay l·∫°i trang ch·ªß</button>
        </div>

        <div id="view-game" class="relative z-10 w-full max-w-md hidden">
            <div class="grid grid-cols-2 gap-3 mb-6">
                <div class="bg-slate-900/90 p-4 rounded-2xl border border-white/10 shadow-xl flex items-center justify-between">
                    <div>
                        <p class="text-[8px] font-black text-indigo-400 uppercase tracking-widest">Th·ªùi gian</p>
                        <p id="timer" class="text-lg font-black font-mono">05:00</p>
                    </div>
                    <div id="lives-container" class="flex gap-1"></div>
                </div>
                <div class="bg-slate-900/90 p-4 rounded-2xl border border-white/10 shadow-xl text-right">
                    <p class="text-[8px] font-black text-indigo-400 uppercase tracking-widest">ƒêi·ªÉm s·ªë</p>
                    <div class="flex items-center justify-end gap-2">
                        <span id="fever-badge" class="hidden bg-orange-500 text-[8px] px-2 py-0.5 rounded font-black animate-pulse uppercase">x2 Fever</span>
                        <p id="score" class="text-2xl font-black text-yellow-400">0</p>
                    </div>
                </div>
            </div>

            <div class="card min-h-[440px] flex flex-col items-center justify-center text-center p-8 relative overflow-hidden shadow-2xl">
                <div id="question-area" class="w-full animate-pop">
                    <div class="flex justify-center gap-1 mb-6" id="streak-dots">
                        <div class="h-1.5 w-8 rounded-full bg-white/10"></div>
                        <div class="h-1.5 w-8 rounded-full bg-white/10"></div>
                        <div class="h-1.5 w-8 rounded-full bg-white/10"></div>
                        <div class="h-1.5 w-8 rounded-full bg-white/10"></div>
                        <div class="h-1.5 w-8 rounded-full bg-white/10"></div>
                    </div>
                    <p id="unit-tag" class="text-indigo-400 text-[10px] font-black uppercase tracking-[0.2em] mb-4">Unit 5: Urbanization</p>
                    <h2 id="word-display" class="text-4xl font-black mb-3 tracking-tight">word...</h2>
                    <p id="meaning-display" class="text-slate-300 italic text-sm mb-12 font-medium"> (nghƒ©a) </p>
                    <div id="options-grid" class="grid grid-cols-1 gap-3 w-full"></div>
                </div>

                <div id="chest-area" class="hidden text-center">
                    <h3 class="text-2xl font-black text-yellow-400 mb-8 uppercase tracking-tighter">CH√çNH X√ÅC! NH·∫¨N QU√Ä</h3>
                    <div class="flex gap-4 justify-center" id="chest-selection">
                        <button onclick="openChest()" class="w-24 h-24 bg-indigo-600 rounded-3xl flex items-center justify-center hover:bg-yellow-500 transition-all hover:scale-110 shadow-xl border border-white/20">
                            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 12V8H4v4"/><path d="M2 12h20"/><path d="M20 12v8H4v-8"/><circle cx="12" cy="12" r="2"/></svg>
                        </button>
                    </div>
                    <div id="chest-result" class="hidden mt-6 p-10 bg-indigo-600 rounded-[2rem] animate-pop border border-white/20">
                        <p id="bonus-text" class="text-4xl font-black text-white">+0ƒë</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-result" class="relative z-10 w-full max-w-md hidden animate-pop">
            <div class="text-center bg-slate-900/95 backdrop-blur-xl border border-white/10 p-12 rounded-[3rem] shadow-2xl">
                <div class="w-20 h-20 bg-yellow-500 rounded-full flex items-center justify-center mx-auto mb-6 shadow-yellow-500/30 shadow-2xl">
                    <svg id="trophy-icon" xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
                </div>
                <h2 id="result-status" class="text-2xl font-black mb-1 uppercase italic tracking-tighter text-white">XONG TR·∫¨N!</h2>
                <p id="rank-display" class="text-indigo-400 font-black uppercase text-xs tracking-[0.2em] mb-8">Danh hi·ªáu: T√¢n binh</p>
                <div class="my-8">
                    <p class="text-indigo-400 text-[10px] font-black uppercase tracking-widest mb-1">ƒêi·ªÉm ƒë·∫°t ƒë∆∞·ª£c</p>
                    <p id="final-score" class="text-7xl font-black text-white tracking-tighter drop-shadow-lg">0</p>
                </div>
                <div id="new-record-tag" class="hidden mb-6 bg-red-600/20 text-red-400 py-2 rounded-xl border border-red-500/30 font-black text-xs uppercase tracking-widest">K·ª∑ l·ª•c m·ªõi!</div>
                <button onclick="location.reload()" class="w-full bg-white text-indigo-700 py-5 rounded-2xl font-black text-lg hover:bg-indigo-600 hover:text-white transition-all shadow-lg">TH·ª¨ L·∫†I</button>
            </div>
        </div>
    </div>

    <script>
        // --- Ng√¢n h√†ng t·ª´ v·ª±ng b·ªï sung ---
        const PREP_WORDS = [
            { id: 1, word: "ban... ", prep: "from", meaning: "c·∫•m l√†m ƒëi·ªÅu g√¨ ƒë√≥", type: "prep" },
            { id: 2, word: "benefit ", prep: "from", meaning: "c√≥ l·ª£i t·ª´ th·ª© g√¨ ƒë√≥", type: "prep" },
            { id: 3, word: "believe ", prep: "in", meaning: "tin v√†o", type: "prep" },
            { id: 4, word: "specialize ", prep: "in", meaning: "chuy√™n v·ªÅ", type: "prep" },
            { id: 5, word: "accuse sb... ", prep: "of", meaning: "bu·ªôc t·ªôi v√¨ ƒëi·ªÅu g√¨", type: "prep" },
            { id: 6, word: "remind sb... ", prep: "of", meaning: "nh·∫Øc nh·ªü v·ªÅ ƒëi·ªÅu g√¨", type: "prep" },
            { id: 7, word: "agree ", prep: "on", meaning: "ƒë·ªìng √Ω v·ªÅ ƒëi·ªÅu g√¨", type: "prep" },
            { id: 8, word: "rely ", prep: "on", meaning: "d·ª±a v√†o", type: "prep" },
            { id: 9, word: "belong ", prep: "to", meaning: "thu·ªôc v·ªÅ", type: "prep" },
            { id: 10, word: "object ", prep: "to", meaning: "ph·∫£n ƒë·ªëi", type: "prep" },
            { id: 11, word: "satisfied ", prep: "with", meaning: "h√†i l√≤ng v·ªõi", type: "prep" },
            { id: 12, word: "famous ", prep: "for", meaning: "n·ªïi ti·∫øng v·ªÅ", type: "prep" },
            { id: 13, word: "proud ", prep: "of", meaning: "t·ª± h√†o v·ªÅ", type: "prep" },
            { id: 14, word: "anxious ", prep: "about", meaning: "lo l·∫Øng v·ªÅ", type: "prep" },
            { id: 15, word: "succeed ", prep: "in", meaning: "th√†nh c√¥ng v·ªÅ ƒëi·ªÅu g√¨", type: "prep" },
            { id: 16, word: "invest ", prep: "in", meaning: "ƒë·∫ßu t∆∞ v√†o", type: "prep" },
            { id: 17, word: "result ", prep: "in", meaning: "d·∫´n ƒë·∫øn k·∫øt qu·∫£", type: "prep" },
            { id: 18, word: "result ", prep: "from", meaning: "do b·ªüi (nguy√™n nh√¢n)", type: "prep" },
            { id: 19, word: "recover ", prep: "from", meaning: "h·ªìi ph·ª•c t·ª´", type: "prep" },
            { id: 20, word: "prepare ", prep: "for", meaning: "chu·∫©n b·ªã cho", type: "prep" },
            { id: 21, word: "wait ", prep: "for", meaning: "ch·ªù ƒë·ª£i", type: "prep" },
            { id: 22, word: "concentrate ", prep: "on", meaning: "t·∫≠p trung v√†o", type: "prep" },
            { id: 23, word: "insist ", prep: "on", meaning: "khƒÉng khƒÉng l√†m g√¨", type: "prep" },
            { id: 24, word: "congratulate sb... ", prep: "on", meaning: "ch√∫c m·ª´ng ai v√¨ ƒëi·ªÅu g√¨", type: "prep" },
            { id: 25, word: "apologize to sb... ", prep: "for", meaning: "xin l·ªói v·ªÅ ƒëi·ªÅu g√¨", type: "prep" },
            { id: 26, word: "capable ", prep: "of", meaning: "c√≥ kh·∫£ nƒÉng l√†m g√¨", type: "prep" },
            { id: 27, word: "keen ", prep: "on", meaning: "say m√™ ƒëi·ªÅu g√¨", type: "prep" },
            { id: 28, word: "accustomed ", prep: "to", meaning: "quen v·ªõi", type: "prep" },
            { id: 29, word: "provide sb... ", prep: "with", meaning: "cung c·∫•p c√°i g√¨ cho ai", type: "prep" },
            { id: 30, word: "depend ", prep: "on", meaning: "ph·ª• thu·ªôc v√†o", type: "prep" },
            { id: 31, word: "base... ", prep: "on", meaning: "d·ª±a tr√™n", type: "prep" },
            { id: 32, word: "suffer ", prep: "from", meaning: "ch·ªãu ƒë·ª±ng (b·ªánh t·∫≠t)", type: "prep" },
            { id: 33, word: "translate... ", prep: "into", meaning: "d·ªãch sang", type: "prep" },
            { id: 34, word: "divide... ", prep: "into", meaning: "chia th√†nh", type: "prep" },
            { id: 35, word: "compare... ", prep: "with", meaning: "so s√°nh v·ªõi", type: "prep" },
            { id: 36, word: "afraid ", prep: "of", meaning: "s·ª£ h√£i ƒëi·ªÅu g√¨", type: "prep" },
            { id: 37, word: "interested ", prep: "in", meaning: "quan t√¢m ƒë·∫øn", type: "prep" },
            { id: 38, word: "tired ", prep: "of", meaning: "m·ªát m·ªèi v√¨", type: "prep" },
            { id: 39, word: "worried ", prep: "about", meaning: "lo l·∫Øng v·ªÅ", type: "prep" },
            { id: 40, word: "similar ", prep: "to", meaning: "t∆∞∆°ng t·ª± v·ªõi", type: "prep" },
            { id: 41, word: "absent ", prep: "from", meaning: "v·∫Øng m·∫∑t kh·ªèi", type: "prep" },
            { id: 42, word: "addicted ", prep: "to", meaning: "nghi·ªán th·ª© g√¨", type: "prep" },
            { id: 43, word: "crowded ", prep: "with", meaning: "ƒë√¥ng ƒë√∫c v·ªõi", type: "prep" },
            { id: 44, word: "engaged ", prep: "in", meaning: "tham gia v√†o / b·∫≠n r·ªôn", type: "prep" },
            { id: 45, word: "opposed ", prep: "to", meaning: "ph·∫£n ƒë·ªëi", type: "prep" },
            { id: 46, word: "aware ", prep: "of", meaning: "nh·∫≠n th·ª©c v·ªÅ", type: "prep" },
            { id: 47, word: "full ", prep: "of", meaning: "ƒë·∫ßy r·∫´y", type: "prep" },
            { id: 48, word: "good ", prep: "at", meaning: "gi·ªèi v·ªÅ", type: "prep" },
            { id: 49, word: "bad ", prep: "at", meaning: "t·ªá v·ªÅ", type: "prep" },
            { id: 50, word: "different ", prep: "from", meaning: "kh√°c bi·ªát v·ªõi", type: "prep" },
            { id: 51, word: "abundance ", prep: "of", meaning: "s·ª± phong ph√∫ c·ªßa", type: "prep" },
            { id: 52, word: "ambition ", prep: "of", meaning: "tham v·ªçng l√†m g√¨", type: "prep" },
            { id: 53, word: "tendency ", prep: "to", meaning: "c√≥ xu h∆∞·ªõng l√†m g√¨", type: "prep" },
            { id: 54, word: "influence... ", prep: "on", meaning: "·∫£nh h∆∞·ªüng l√™n", type: "prep" },
            { id: 55, word: "impact... ", prep: "on", meaning: "t√°c ƒë·ªông l√™n", type: "prep" },
            { id: 56, word: "access... ", prep: "to", meaning: "ti·∫øp c·∫≠n v·ªõi", type: "prep" },
            { id: 57, word: "solution ", prep: "to", meaning: "gi·∫£i ph√°p cho", type: "prep" },
            { id: 58, word: "reason ", prep: "for", meaning: "l√Ω do cho", type: "prep" },
            { id: 59, word: "demand ", prep: "for", meaning: "nhu c·∫ßu v·ªÅ", type: "prep" },
            { id: 60, word: "shortage ", prep: "of", meaning: "s·ª± thi·∫øu h·ª•t c√°i g√¨", type: "prep" },
            { id: 61, word: "complain... ", prep: "about", meaning: "ph√†n n√†n v·ªÅ", type: "prep" },
            { id: 62, word: "dream... ", prep: "of/about", meaning: "m∆° v·ªÅ", type: "prep" },
            { id: 63, word: "hear... ", prep: "from", meaning: "nghe tin t·ª´ ai", type: "prep" },
            { id: 64, word: "search... ", prep: "for", meaning: "t√¨m ki·∫øm", type: "prep" },
            { id: 65, word: "suffer... ", prep: "from", meaning: "ch·ªãu ƒë·ª±ng b·ªánh t·∫≠t", type: "prep" },
            { id: 66, word: "think... ", prep: "about", meaning: "nghƒ© v·ªÅ", type: "prep" },
            { id: 67, word: "think... ", prep: "of", meaning: "c√≥ √Ω ki·∫øn v·ªÅ", type: "prep" },
            { id: 68, word: "warn sb... ", prep: "about", meaning: "c·∫£nh b√°o ai v·ªÅ", type: "prep" },
            { id: 69, word: "die... ", prep: "of", meaning: "ch·∫øt v√¨ (b·ªánh)", type: "prep" },
            { id: 70, word: "explain sth... ", prep: "to", meaning: "gi·∫£i th√≠ch cho ai", type: "prep" },
            { id: 71, word: "listen... ", prep: "to", meaning: "l·∫Øng nghe", type: "prep" },
            { id: 72, word: "happen... ", prep: "to", meaning: "x·∫£y ra v·ªõi", type: "prep" },
            { id: 73, word: "invite sb... ", prep: "to", meaning: "m·ªùi ai t·ªõi", type: "prep" },
            { id: 74, word: "pay... ", prep: "for", meaning: "tr·∫£ ti·ªÅn cho", type: "prep" },
            { id: 75, word: "thank sb... ", prep: "for", meaning: "c·∫£m ∆°n ai v√¨", type: "prep" },
            { id: 76, word: "leave... ", prep: "for", meaning: "r·ªùi ƒëi ƒë·ªÉ t·ªõi ƒë√¢u", type: "prep" },
            { id: 77, word: "ask sb... ", prep: "for", meaning: "h·ªèi xin ai c√°i g√¨", type: "prep" },
            { id: 78, word: "blame sb... ", prep: "for", meaning: "ƒë·ªï l·ªói cho ai v√¨", type: "prep" },
            { id: 79, word: "borrow sth... ", prep: "from", meaning: "m∆∞·ª£n c√°i g√¨ t·ª´", type: "prep" },
            { id: 80, word: "protect... ", prep: "from", meaning: "b·∫£o v·ªá kh·ªèi", type: "prep" },
            { id: 81, word: "prevent... ", prep: "from", meaning: "ngƒÉn ch·∫∑n kh·ªèi", type: "prep" },
            { id: 82, word: "stop... ", prep: "from", meaning: "d·ª´ng l·∫°i kh·ªèi", type: "prep" },
            { id: 83, word: "laugh... ", prep: "at", meaning: "c∆∞·ªùi nh·∫°o", type: "prep" },
            { id: 84, word: "look... ", prep: "at", meaning: "nh√¨n v√†o", type: "prep" },
            { id: 85, word: "stare... ", prep: "at", meaning: "nh√¨n ch·∫±m ch·∫±m", type: "prep" },
            { id: 86, word: "glance... ", prep: "at", meaning: "li·∫øc nh√¨n", type: "prep" },
            { id: 87, word: "point sth... ", prep: "at", meaning: "ch·ªâ c√°i g√¨ v√†o", type: "prep" },
            { id: 88, word: "shout... ", prep: "at", meaning: "h√©t v√†o m·∫∑t ai", type: "prep" },
            { id: 89, word: "throw sth... ", prep: "at", meaning: "n√©m c√°i g√¨ v√†o ai (t·∫•n c√¥ng)", type: "prep" },
            { id: 90, word: "shout... ", prep: "to", meaning: "g·ªçi to cho ai nghe", type: "prep" },
            { id: 91, word: "throw sth... ", prep: "to", meaning: "n√©m cho ai b·∫Øt", type: "prep" },
            { id: 92, word: "depend... ", prep: "on", meaning: "ph·ª• thu·ªôc v√†o", type: "prep" },
            { id: 93, word: "base... ", prep: "on", meaning: "d·ª±a tr√™n", type: "prep" },
            { id: 94, word: "comment... ", prep: "on", meaning: "b√¨nh lu·∫≠n v·ªÅ", type: "prep" },
            { id: 95, word: "work... ", prep: "on", meaning: "l√†m vi·ªác tr√™n (d·ª± √°n)", type: "prep" },
            { id: 96, word: "experience... ", prep: "in", meaning: "kinh nghi·ªám v·ªÅ", type: "prep" },
            { id: 97, word: "difficulty... ", prep: "in", meaning: "kh√≥ khƒÉn trong", type: "prep" },
            { id: 98, word: "increase... ", prep: "in", meaning: "s·ª± tƒÉng l√™n v·ªÅ", type: "prep" },
            { id: 99, word: "decrease... ", prep: "in", meaning: "s·ª± gi·∫£m xu·ªëng v·ªÅ", type: "prep" },
            { id: 100, word: "fall... ", prep: "in", meaning: "s·ª± s·ª•t gi·∫£m v·ªÅ", type: "prep" }
        ];

        const VOCAB_WORDS = [
            { id: 321, word: "high-rise building", viet: "t√≤a nh√† cao t·∫ßng", type: "vocab" },
            { id: 322, word: "industrial area", viet: "khu c√¥ng nghi·ªáp", type: "vocab" },
            { id: 323, word: "megacity", viet: "si√™u ƒë√¥ th·ªã", type: "vocab" },
            { id: 324, word: "overpopulation", viet: "qu√° t·∫£i d√¢n s·ªë", type: "vocab" },
            { id: 325, word: "rural migration", viet: "s·ª± di c∆∞ n√¥ng th√¥n", type: "vocab" },
            { id: 326, word: "slum", viet: "khu nh√† ·ªï chu·ªôt", type: "vocab" },
            { id: 327, word: "affordable", viet: "gi√° c·∫£ ph·∫£i chƒÉng", type: "vocab" },
            { id: 328, word: "agriculture", viet: "ng√†nh n√¥ng nghi·ªáp", type: "vocab" },
            { id: 329, word: "contribute", viet: "ƒë√≥ng g√≥p, g√≥p ph·∫ßn", type: "vocab" },
            { id: 330, word: "deforestation", viet: "n·∫°n ph√° r·ª´ng", type: "vocab" },
            { id: 331, word: "opportunity", viet: "c∆° h·ªôi", type: "vocab" },
            { id: 332, word: "policy", viet: "ch√≠nh s√°ch", type: "vocab" },
            { id: 333, word: "urbanisation", viet: "ƒë√¥ th·ªã h√≥a", type: "vocab" },
            { id: 334, word: "breathtaking", viet: "tuy·ªát ƒë·∫πp, kinh ng·∫°c", type: "vocab" },
            { id: 335, word: "crop failure", viet: "m·∫•t m√πa", type: "vocab" },
            { id: 336, word: "infrastructure", viet: "c∆° s·ªü h·∫° t·∫ßng", type: "vocab" },
            { id: 337, word: "mindset", viet: "t∆∞ duy, quan ƒëi·ªÉm", type: "vocab" },
            { id: 338, word: "prosperous", viet: "th·ªãnh v∆∞·ª£ng, gi√†u c√≥", type: "vocab" },
            { id: 339, word: "sanitation", viet: "h·ªá th·ªëng v·ªá sinh", type: "vocab" },
            { id: 340, word: "shortage", viet: "s·ª± thi·∫øu h·ª•t", type: "vocab" },
            { id: 341, word: "sustainable", viet: "b·ªÅn v·ªØng", type: "vocab" },
            { id: 342, word: "upmarket", viet: "h·∫°ng sang, cao c·∫•p", type: "vocab" },
            { id: 343, word: "wastewater", viet: "n∆∞·ªõc th·∫£i", type: "vocab" },
            { id: 344, word: "weather-beaten", viet: "d√†y d·∫°n s∆∞∆°ng gi√≥", type: "vocab" },
            { id: 345, word: "well-off", viet: "gi√†u c√≥, kh√° gi·∫£", type: "vocab" },
            { id: 346, word: "cost of living", viet: "chi ph√≠ sinh ho·∫°t", type: "vocab" },
            { id: 347, word: "density", viet: "m·∫≠t ƒë·ªô", type: "vocab" },
            { id: 348, word: "employment", viet: "vi·ªác l√†m", type: "vocab" },
            { id: 349, word: "housing", viet: "nh√† ·ªü", type: "vocab" },
            { id: 350, word: "inhabitant", viet: "c∆∞ d√¢n", type: "vocab" },
            { id: 351, word: "smog", viet: "kh√≥i b·ª•i √¥ nhi·ªÖm", type: "vocab" }
        ];

        const WORD_BANK_U5 = [...PREP_WORDS, ...VOCAB_WORDS];
        const PREPS = ["from", "in", "of", "on", "to", "with", "for", "about", "at", "into"];
        
        const SOUNDS = {
            correct: 'https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3',
            wrong: 'https://assets.mixkit.co/active_storage/sfx/2955/2955-preview.mp3',
            chest: 'https://assets.mixkit.co/active_storage/sfx/2017/2017-preview.mp3',
            gameover: 'https://assets.mixkit.co/active_storage/sfx/253/253-preview.mp3',
            loseLife: 'https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3',
            milestone: 'https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3',
            fireworks: 'https://assets.mixkit.co/active_storage/sfx/2016/2016-preview.mp3'
        };

        function playSound(type) {
            new Audio(SOUNDS[type]).play().catch(() => {});
        }

        function triggerFireworks() {
            playSound('fireworks');
            var duration = 5 * 1000;
            var animationEnd = Date.now() + duration;
            var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
            function randomInRange(min, max) { return Math.random() * (max - min) + min; }
            var interval = setInterval(function() {
              var timeLeft = animationEnd - Date.now();
              if (timeLeft <= 0) return clearInterval(interval);
              var particleCount = 50 * (timeLeft / duration);
              confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
              confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
            }, 250);
        }

        let score = 0;
        let timeLeft = 300; 
        let currentQ = null;
        let timerId = null;
        let streak = 0;
        let lives = 3;
        let isFever = false;
        let consecutiveWrong = 0; 
        let lastMilestoneReached = 0; 

        window.onload = () => {
            const best = localStorage.getItem('grade12_best_score');
            if(best) {
                document.getElementById('best-score-container').classList.remove('hidden');
                document.getElementById('best-score-display').innerText = best;
            }
        };

        function showUnitSelection() {
            document.getElementById('view-landing').classList.add('hidden');
            document.getElementById('view-selection').classList.remove('hidden');
        }

        function selectUnit(u) {
            if (u !== 5) return;
            document.getElementById('view-selection').classList.add('hidden');
            document.getElementById('view-game').classList.remove('hidden');
            startGame();
        }

        function updateLives() {
            const container = document.getElementById('lives-container');
            container.innerHTML = '';
            for(let i=0; i<3; i++) {
                const heart = document.createElement('span');
                heart.className = `heart text-xl transition-all duration-300 ${i < lives ? 'scale-110' : 'opacity-20 grayscale scale-90'}`;
                heart.innerText = '‚ù§Ô∏è';
                container.appendChild(heart);
            }
        }

        function showFlashMessage(text, colorClass) {
            const overlay = document.getElementById('status-overlay');
            const statusText = document.getElementById('status-text');
            statusText.innerText = text;
            statusText.className = `text-5xl font-black italic uppercase tracking-tighter drop-shadow-2xl ${colorClass}`;
            overlay.classList.remove('hidden');
            overlay.classList.add('animate-pop');
            setTimeout(() => {
                overlay.classList.add('hidden');
                overlay.classList.remove('animate-pop');
            }, 1200);
        }

        function startGame() {
            score = 0; streak = 0; lives = 3; consecutiveWrong = 0; lastMilestoneReached = 0; isFever = false;
            timeLeft = 300;
            document.body.classList.remove('fever-mode');
            updateScore(); updateLives(); nextQuestion();
            timerId = setInterval(() => {
                timeLeft--;
                const m = Math.floor(timeLeft/60);
                const s = timeLeft%60;
                document.getElementById('timer').innerText = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                if(timeLeft <= 0) endGame();
            }, 1000);
        }

        function nextQuestion() {
            document.getElementById('question-area').classList.remove('hidden');
            document.getElementById('chest-area').classList.add('hidden');
            document.getElementById('chest-selection').classList.remove('hidden');
            document.getElementById('chest-result').classList.add('hidden');

            currentQ = WORD_BANK_U5[Math.floor(Math.random() * WORD_BANK_U5.length)];
            document.getElementById('word-display').innerText = currentQ.word;
            
            const isVocab = currentQ.type === 'vocab';
            const grid = document.getElementById('options-grid');
            grid.innerHTML = '';

            if (isVocab) {
                document.getElementById('unit-tag').innerText = "Unit 5: Vocabulary Meaning";
                document.getElementById('meaning-display').innerText = "(Ch·ªçn nghƒ©a ƒë√∫ng c·ªßa t·ª´)";
                grid.className = "grid grid-cols-1 gap-2 w-full";
                let opts = [currentQ.viet];
                const allViets = VOCAB_WORDS.map(w => w.viet);
                while(opts.length < 4) {
                    const r = allViets[Math.floor(Math.random() * allViets.length)];
                    if(!opts.includes(r)) opts.push(r);
                }
                opts.sort(() => Math.random() - 0.5);
                opts.forEach(o => {
                    const b = document.createElement('button');
                    b.className = 'btn-opt text-sm py-3';
                    b.innerText = o;
                    b.onclick = () => check(o);
                    grid.appendChild(b);
                });
            } else {
                document.getElementById('unit-tag').innerText = "Unit 5: Prepositions Bank";
                document.getElementById('meaning-display').innerText = `(${currentQ.meaning})`;
                grid.className = "grid grid-cols-2 gap-4 w-full";
                let opts = [currentQ.prep];
                while(opts.length < 4) {
                    const r = PREPS[Math.floor(Math.random() * PREPS.length)];
                    if(!opts.includes(r)) opts.push(r);
                }
                opts.sort(() => Math.random() - 0.5);
                opts.forEach(o => {
                    const b = document.createElement('button');
                    b.className = 'btn-opt';
                    b.innerText = o;
                    b.onclick = () => check(o);
                    grid.appendChild(b);
                });
            }
            const dots = document.getElementById('streak-dots').children;
            for(let i=0; i<5; i++) {
                dots[i].className = `h-1.5 w-6 rounded-full transition-all ${i < (streak % 5 === 0 && streak > 0 ? 5 : streak % 5) ? 'bg-green-400 shadow-[0_0_10px_#4ade80]' : 'bg-white/10'}`;
            }
        }

        function checkMilestones() {
            const milestone = Math.floor(score / 100);
            if (milestone > lastMilestoneReached) {
                lastMilestoneReached = milestone;
                playSound('milestone');
                if (milestone >= 10 && milestone % 10 === 0) {
                    triggerFireworks();
                    showFlashMessage(`HUY·ªÄN THO·∫†I! ƒê·∫†T M·ªêC ${milestone * 100} ƒêI·ªÇM`, 'text-orange-500');
                } else {
                    showFlashMessage(`TUY·ªÜT V·ªúI! ƒê·∫†T M·ªêC ${milestone * 100} ƒêI·ªÇM`, 'text-yellow-400');
                }
            }
        }

        function check(ans) {
            const correct = currentQ.type === 'vocab' ? currentQ.viet : currentQ.prep;
            if(ans === correct) {
                playSound('correct');
                streak++; consecutiveWrong = 0; 
                if(streak % 5 === 0) {
                    isFever = true;
                    document.body.classList.add('fever-mode');
                    document.getElementById('fever-badge').classList.remove('hidden');
                }
                score += isFever ? 10 : 5;
                checkMilestones();
                if(streak % 3 === 0) showChest();
                else nextQuestion();
            } else {
                playSound('wrong');
                streak = 0; consecutiveWrong++; 
                isFever = false;
                document.body.classList.remove('fever-mode');
                document.getElementById('fever-badge').classList.add('hidden');
                if (consecutiveWrong >= 2) {
                    lives--; consecutiveWrong = 0;
                    playSound('loseLife'); updateLives();
                    showFlashMessage("WARNING: B·∫†N ƒê√É M·∫§T 1 M·∫†NG!", "text-red-500");
                    if(lives <= 0) { playSound('gameover'); endGame(); return; }
                }
                document.getElementById('question-area').classList.add('animate-pulse');
                setTimeout(() => { document.getElementById('question-area').classList.remove('animate-pulse'); nextQuestion(); }, 400);
            }
            updateScore();
        }

        function showChest() {
            document.getElementById('question-area').classList.add('hidden');
            document.getElementById('chest-area').classList.remove('hidden');
        }

        function openChest() {
            playSound('chest');
            const bonus = Math.floor(Math.random() * 20) + 10;
            score += bonus; updateScore();
            document.getElementById('chest-selection').classList.add('hidden');
            document.getElementById('chest-result').classList.remove('hidden');
            document.getElementById('bonus-text').innerText = `+${bonus} ƒêI·ªÇM!`;
            setTimeout(() => { checkMilestones(); }, 500);
            setTimeout(nextQuestion, 1500);
        }

        function updateScore() { document.getElementById('score').innerText = score; }

        function endGame() {
            clearInterval(timerId);
            const best = localStorage.getItem('grade12_best_score') || 0;
            if(score > best) {
                localStorage.setItem('grade12_best_score', score);
                document.getElementById('new-record-tag').classList.remove('hidden');
            } else {
                document.getElementById('new-record-tag').classList.add('hidden');
            }
            let rank = "T√¢n binh üë∂";
            if(score > 1000) rank = "Huy·ªÅn tho·∫°i üåå";
            else if(score >= 501) rank = "B·∫≠c th·∫ßy t·ª´ v·ª±ng üíé";
            else if(score >= 201) rank = "Th·ª£ sƒÉn t·ª´ v·ª±ng üèπ";

            document.getElementById('rank-display').innerText = "Danh hi·ªáu: " + rank;
            document.getElementById('view-game').classList.add('hidden');
            document.getElementById('view-result').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
            document.getElementById('result-status').innerText = lives <= 0 ? "B·∫†N ƒê√É H·∫æT TIM!" : "H·∫æT GI·ªú!";
            if(score > 1000) triggerFireworks();
        }
    </script>
</body>
</html>
