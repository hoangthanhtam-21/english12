<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 12 - Vocabulary Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            margin: 0; 
            overflow-x: hidden;
            background-image: url('https://img.freepik.com/free-vector/flat-design-english-school-background_23-2149487419.jpg?w=2000');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
            transition: background 0.5s ease;
        }
        .hidden { display: none !important; }
        #app {
            background: rgba(2, 6, 23, 0.85);
            backdrop-filter: blur(4px);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .fever-mode #app {
            background: rgba(79, 70, 229, 0.6);
            box-shadow: inset 0 0 100px rgba(255, 255, 255, 0.2);
        }
        .glow { box-shadow: 0 0 25px rgba(79, 70, 229, 0.5); }
        .card { 
            background: rgba(15, 23, 42, 0.9); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(255,255,255,0.15); 
            border-radius: 2rem; 
        }
        .unit-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .unit-card:not(.locked):hover {
            background: rgba(79, 70, 229, 0.2);
            border-color: #4f46e5;
            transform: translateY(-5px);
        }
        .locked { opacity: 0.5; cursor: not-allowed; }
        .btn-opt { 
            background: rgba(255,255,255,0.08); 
            border: 1px solid rgba(255,255,255,0.15); 
            padding: 1.25rem; 
            border-radius: 1rem; 
            transition: all 0.2s; 
            font-weight: 800; 
            font-size: 1.1rem; 
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        .btn-opt:hover { 
            background: white; 
            color: #4f46e5; 
            transform: scale(1.02); 
        }
        .animate-pop { animation: pop 0.3s ease-out; }
        @keyframes pop { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .heart { color: #ef4444; filter: drop-shadow(0 0 5px rgba(239, 68, 68, 0.5)); }
        
        .status-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
            pointer-events: none;
            text-align: center;
            width: 100%;
        }
    </style>
</head>
<body>
    <div id="app" class="p-6 relative">
        <!-- Th√¥ng b√°o C·∫£nh b√°o/Ch√∫c m·ª´ng -->
        <div id="status-overlay" class="status-overlay hidden">
            <h2 id="status-text" class="text-5xl font-black italic uppercase tracking-tighter drop-shadow-2xl">MESSAGE</h2>
        </div>

        <!-- M√ÄN H√åNH CH√ÄO -->
        <div id="view-landing" class="relative z-10 text-center w-full max-w-md animate-pop">
            <div class="w-20 h-20 bg-indigo-600 rounded-[2rem] flex items-center justify-center mx-auto mb-8 glow">
                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="m16 6 4 14H4L8 6Z"/><path d="M12 2v4"/><path d="m8 2 1 1"/><path d="m16 2-1 1"/></svg>
            </div>
            <h1 class="text-4xl font-black mb-2 tracking-tighter uppercase italic text-white drop-shadow-lg">Grade 12</h1>
            <h2 class="text-2xl font-bold mb-4 text-indigo-300">Vocabulary Master</h2>
            
            <div id="best-score-container" class="mb-8 hidden">
                <p class="text-[10px] font-black uppercase tracking-[0.3em] text-slate-400">K·ª∑ l·ª•c c√° nh√¢n</p>
                <p id="best-score-display" class="text-2xl font-black text-yellow-400">0</p>
            </div>

            <button onclick="showUnitSelection()" class="w-full bg-white text-indigo-700 py-5 rounded-2xl font-black text-lg hover:bg-indigo-600 hover:text-white transition-all shadow-2xl uppercase">B·∫Øt ƒë·∫ßu</button>
        </div>

        <!-- M√ÄN H√åNH CH·ªåN UNIT -->
        <div id="view-selection" class="relative z-10 w-full max-w-2xl hidden animate-pop text-center">
            <h2 class="text-3xl font-black uppercase tracking-tighter text-white mb-10">Ch·ªçn b√†i h·ªçc</h2>
            <div id="unit-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Rendered by JS -->
            </div>
            <button onclick="location.reload()" class="mt-12 text-slate-400 text-xs font-black uppercase tracking-[0.2em] hover:text-white transition-colors underline">Quay l·∫°i trang ch·ªß</button>
        </div>

        <!-- M√ÄN H√åNH CH∆†I GAME -->
        <div id="view-game" class="relative z-10 w-full max-w-md hidden">
            <div class="grid grid-cols-2 gap-3 mb-6">
                <div class="bg-slate-900/90 p-4 rounded-2xl border border-white/10 shadow-xl flex items-center justify-between text-white">
                    <div>
                        <p class="text-[8px] font-black text-indigo-400 uppercase tracking-widest">Th·ªùi gian</p>
                        <p id="timer" class="text-lg font-black font-mono">05:00</p>
                    </div>
                    <div id="lives-container" class="flex gap-1"></div>
                </div>
                <div class="bg-slate-900/90 p-4 rounded-2xl border border-white/10 shadow-xl text-right text-white">
                    <p class="text-[8px] font-black text-indigo-400 uppercase tracking-widest">ƒêi·ªÉm s·ªë</p>
                    <div class="flex items-center justify-end gap-2">
                        <span id="fever-badge" class="hidden bg-orange-500 text-[8px] px-2 py-0.5 rounded font-black animate-pulse uppercase">x2 Fever</span>
                        <p id="score" class="text-2xl font-black text-yellow-400">0</p>
                    </div>
                </div>
            </div>

            <div class="card min-h-[440px] flex flex-col items-center justify-center text-center p-8 relative overflow-hidden shadow-2xl">
                <div id="loading-msg" class="hidden text-indigo-400 font-bold animate-pulse uppercase tracking-widest text-sm">ƒêang t·∫£i d·ªØ li·ªáu...</div>
                
                <div id="question-area" class="w-full animate-pop">
                    <div class="flex justify-center gap-1 mb-6" id="streak-dots">
                        <div class="h-1.5 w-6 rounded-full bg-white/10"></div>
                        <div class="h-1.5 w-6 rounded-full bg-white/10"></div>
                        <div class="h-1.5 w-6 rounded-full bg-white/10"></div>
                        <div class="h-1.5 w-6 rounded-full bg-white/10"></div>
                        <div class="h-1.5 w-6 rounded-full bg-white/10"></div>
                    </div>
                    <p id="unit-tag" class="text-indigo-400 text-[10px] font-black uppercase tracking-[0.2em] mb-4"></p>
                    <h2 id="word-display" class="text-4xl font-black mb-3 tracking-tight text-white"></h2>
                    <p id="meaning-display" class="text-slate-300 italic text-sm mb-12 font-medium"></p>
                    <div id="options-grid" class="grid grid-cols-1 gap-3 w-full"></div>
                </div>

                <div id="chest-area" class="hidden text-center">
                    <h3 class="text-2xl font-black text-yellow-400 mb-8 uppercase tracking-tighter">CH√çNH X√ÅC! NH·∫¨N QU√Ä</h3>
                    <div class="flex gap-4 justify-center" id="chest-selection">
                        <button onclick="openChest()" class="w-24 h-24 bg-indigo-600 rounded-3xl flex items-center justify-center hover:bg-yellow-500 transition-all hover:scale-110 shadow-xl border border-white/20">
                            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 12V8H4v4"/><path d="M2 12h20"/><path d="M20 12v8H4v-8"/><circle cx="12" cy="12" r="2"/></svg>
                        </button>
                    </div>
                    <div id="chest-result" class="hidden mt-6 p-10 bg-indigo-600 rounded-[2rem] animate-pop border border-white/20">
                        <p id="bonus-text" class="text-4xl font-black text-white">+0ƒë</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- M√ÄN H√åNH K·∫æT QU·∫¢ -->
        <div id="view-result" class="relative z-10 w-full max-w-md hidden animate-pop">
            <div class="text-center bg-slate-900/95 backdrop-blur-xl border border-white/10 p-12 rounded-[3rem] shadow-2xl">
                <div class="w-20 h-20 bg-yellow-500 rounded-full flex items-center justify-center mx-auto mb-6 shadow-yellow-500/30 shadow-2xl">
                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
                </div>
                <h2 id="result-status" class="text-2xl font-black mb-1 uppercase italic tracking-tighter text-white">XONG TR·∫¨N!</h2>
                <p id="rank-display" class="text-indigo-400 font-black uppercase text-xs tracking-[0.2em] mb-8"></p>
                <div class="my-8">
                    <p class="text-indigo-400 text-[10px] font-black uppercase tracking-widest mb-1">ƒêi·ªÉm ƒë·∫°t ƒë∆∞·ª£c</p>
                    <p id="final-score" class="text-7xl font-black text-white tracking-tighter drop-shadow-lg">0</p>
                </div>
                <div id="new-record-tag" class="hidden mb-6 bg-red-600/20 text-red-400 py-2 rounded-xl border border-red-500/30 font-black text-xs uppercase tracking-widest">K·ª∑ l·ª•c m·ªõi!</div>
                <button onclick="location.reload()" class="w-full bg-white text-indigo-700 py-5 rounded-2xl font-black text-lg hover:bg-indigo-600 hover:text-white transition-all shadow-lg uppercase">Ch∆°i ti·∫øp</button>
            </div>
        </div>
    </div>

    <script>
        // --- C·∫§U H√åNH ---
        const UNITS = [
            { id: 5, name: "Urbanization", file: "unit5.json", status: "ready" },
            { id: 6, name: "Endangered Species", file: "unit6.json", status: "soon" },
            { id: 7, name: "AI", file: "unit7.json", status: "soon" },
            { id: 8, name: "World of Work", file: "unit8.json", status: "soon" }
        ];

        const PREPS_POOL = ["from", "in", "of", "on", "to", "with", "for", "about", "at", "into"];
        const SOUNDS = {
            correct: 'https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3',
            wrong: 'https://assets.mixkit.co/active_storage/sfx/2955/2955-preview.mp3',
            chest: 'https://assets.mixkit.co/active_storage/sfx/2017/2017-preview.mp3',
            gameover: 'https://assets.mixkit.co/active_storage/sfx/253/253-preview.mp3',
            loseLife: 'https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3',
            milestone: 'https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3',
            fireworks: 'https://assets.mixkit.co/active_storage/sfx/2016/2016-preview.mp3'
        };

        // --- TR·∫†NG TH√ÅI ---
        let currentWordBank = [];
        let score = 0, streak = 0, lives = 3, consecutiveWrong = 0, timeLeft = 300;
        let timerId = null, currentQ = null, lastMilestone = 0, isFever = false;

        window.onload = () => {
            renderUnitSelection();
            const best = localStorage.getItem('grade12_best_score');
            if(best) {
                document.getElementById('best-score-container').classList.remove('hidden');
                document.getElementById('best-score-display').innerText = best;
            }
        };

        function renderUnitSelection() {
            const grid = document.getElementById('unit-grid');
            grid.innerHTML = UNITS.map(u => `
                <div onclick="${u.status === 'ready' ? `selectUnit(${u.id})` : ''}" class="unit-card p-8 rounded-[2rem] ${u.status === 'ready' ? 'cursor-pointer' : 'locked relative overflow-hidden'}">
                    ${u.status === 'soon' ? `<div class="absolute inset-0 bg-slate-950/40 flex items-center justify-center backdrop-blur-[1px]"><span class="bg-slate-800 text-slate-400 text-[10px] font-black px-4 py-2 rounded-full uppercase border border-white/5">S·∫Øp ra m·∫Øt</span></div>` : ''}
                    <span class="bg-indigo-500/20 text-indigo-400 text-[10px] font-black px-3 py-1 rounded-full uppercase tracking-widest">Unit ${u.id}</span>
                    <h3 class="text-2xl font-black mt-4 uppercase text-white">${u.name}</h3>
                    <p class="text-slate-400 text-sm mt-1 uppercase tracking-tighter">B·∫•m ƒë·ªÉ n·∫°p d·ªØ li·ªáu</p>
                </div>
            `).join('');
        }

        async function selectUnit(id) {
            const unit = UNITS.find(u => u.id === id);
            document.getElementById('view-selection').classList.add('hidden');
            document.getElementById('view-game').classList.remove('hidden');
            document.getElementById('loading-msg').classList.remove('hidden');
            document.getElementById('question-area').classList.add('hidden');

            try {
                // T·∫£i file JSON t·ª´ c√πng th∆∞ m·ª•c (GitHub Pages)
                const response = await fetch(`./${unit.file}`);
                if (!response.ok) throw new Error("File not found");
                currentWordBank = await response.json();
                startGame();
            } catch (err) {
                alert(`L·ªói: Kh√¥ng t√¨m th·∫•y file ${unit.file} tr√™n GitHub. Vui l√≤ng ƒë·∫£m b·∫£o t·ªáp JSON n·∫±m c√πng th∆∞ m·ª•c v·ªõi index.html!`);
                location.reload();
            }
        }

        function playSound(t) { new Audio(SOUNDS[t]).play().catch(()=>{}); }

        function triggerFireworks() {
            playSound('fireworks');
            let end = Date.now() + 5000;
            let interval = setInterval(() => {
                if (Date.now() > end) return clearInterval(interval);
                confetti({ startVelocity: 30, spread: 360, ticks: 60, origin: { x: Math.random(), y: Math.random() - 0.2 } });
            }, 250);
        }

        function startGame() {
            score = 0; streak = 0; lives = 3; consecutiveWrong = 0; lastMilestone = 0; isFever = false; timeLeft = 300;
            document.getElementById('loading-msg').classList.add('hidden');
            document.getElementById('question-area').classList.remove('hidden');
            updateScore(); updateLives(); nextQuestion();
            timerId = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').innerText = `${Math.floor(timeLeft/60).toString().padStart(2,'0')}:${(timeLeft%60).toString().padStart(2,'0')}`;
                if(timeLeft <= 0) endGame();
            }, 1000);
        }

        function nextQuestion() {
            document.getElementById('question-area').classList.remove('hidden');
            document.getElementById('chest-area').classList.add('hidden');
            
            // Ch·ªçn ng·∫´u nhi√™n t·ª´ ng√¢n h√†ng ƒë√£ t·∫£i
            currentQ = currentWordBank[Math.floor(Math.random() * currentWordBank.length)];
            
            const isVocab = currentQ.type === 'vocab';
            document.getElementById('word-display').innerText = currentQ.word;
            document.getElementById('unit-tag').innerText = isVocab ? "Vocabulary Master" : "Prepositions Bank";
            document.getElementById('meaning-display').innerText = isVocab ? "(Ch·ªçn nghƒ©a ti·∫øng Vi·ªát ƒë√∫ng nh·∫•t)" : `(${currentQ.meaning})`;

            const grid = document.getElementById('options-grid');
            grid.innerHTML = '';
            
            // Theo c·∫•u tr√∫c JSON b·∫°n cung c·∫•p:
            // Type "prep" -> ƒë√°p √°n l√† tr∆∞·ªùng "prep"
            // Type "vocab" -> ƒë√°p √°n l√† tr∆∞·ªùng "meaning"
            let correctAns = isVocab ? currentQ.meaning : currentQ.prep;
            let opts = [correctAns];
            
            // T·∫°o pool ƒë√°p √°n nhi·ªÖu
            let pool = isVocab 
                ? currentWordBank.filter(w => w.type === 'vocab').map(w => w.meaning) 
                : PREPS_POOL;

            while(opts.length < 4) {
                let r = pool[Math.floor(Math.random() * pool.length)];
                if(!opts.includes(r)) opts.push(r);
            }

            opts.sort(() => Math.random() - 0.5).forEach(o => {
                let b = document.createElement('button');
                b.className = `btn-opt text-white ${isVocab ? 'text-sm py-3' : 'py-5'}`;
                b.innerText = o;
                b.onclick = () => check(o);
                grid.appendChild(b);
            });

            // Streak dots
            const dots = document.getElementById('streak-dots').children;
            for(let i=0; i<5; i++) dots[i].className = `h-1.5 w-6 rounded-full transition-all duration-500 ${i < (streak % 5 || (streak>0?5:0)) ? 'bg-green-400 shadow-[0_0_10px_#4ade80]' : 'bg-white/10'}`;
        }

        function check(ans) {
            const correct = currentQ.type === 'vocab' ? currentQ.meaning : currentQ.prep;
            if(ans === correct) {
                playSound('correct'); streak++; consecutiveWrong = 0;
                if(streak % 5 === 0) { isFever = true; document.body.classList.add('fever-mode'); document.getElementById('fever-badge').classList.remove('hidden'); }
                score += isFever ? 10 : 5;
                
                // Milestone check (100, 200, 300...)
                if(Math.floor(score/100) > lastMilestone) {
                    lastMilestone = Math.floor(score/100);
                    playSound('milestone');
                    showFlash(lastMilestone*100 + " ƒêI·ªÇM!", lastMilestone>=10?'text-orange-400':'text-yellow-400');
                    if(lastMilestone % 10 === 0) triggerFireworks();
                }
                
                if(streak % 3 === 0) showChest(); else nextQuestion();
            } else {
                playSound('wrong'); streak = 0; consecutiveWrong++; isFever = false;
                document.body.classList.remove('fever-mode');
                document.getElementById('fever-badge').classList.add('hidden');
                
                if(consecutiveWrong >= 2) {
                    lives--; consecutiveWrong = 0; playSound('loseLife'); updateLives();
                    showFlash("M·∫§T 1 M·∫†NG!", "text-red-500");
                    if(lives <= 0) { playSound('gameover'); endGame(); return; }
                }
                
                document.getElementById('question-area').classList.add('animate-pulse');
                setTimeout(() => { document.getElementById('question-area').classList.remove('animate-pulse'); nextQuestion(); }, 400);
            }
            updateScore();
        }

        function showFlash(txt, cls) {
            const o = document.getElementById('status-overlay');
            const t = document.getElementById('status-text');
            t.innerText = txt; t.className = `text-5xl font-black italic uppercase tracking-tighter drop-shadow-2xl ${cls}`;
            o.classList.remove('hidden'); o.classList.add('animate-pop');
            setTimeout(()=>{ o.classList.add('hidden'); o.classList.remove('animate-pop'); }, 1200);
        }

        function showChest() { document.getElementById('question-area').classList.add('hidden'); document.getElementById('chest-area').classList.remove('hidden'); document.getElementById('chest-selection').classList.remove('hidden'); document.getElementById('chest-result').classList.add('hidden'); }
        function openChest() { playSound('chest'); let b = Math.floor(Math.random()*20)+10; score+=b; updateScore(); document.getElementById('chest-selection').classList.add('hidden'); document.getElementById('chest-result').classList.remove('hidden'); document.getElementById('bonus-text').innerText = `+${b} ƒêI·ªÇM!`; setTimeout(nextQuestion, 1200); }
        function updateScore() { document.getElementById('score').innerText = score; }
        function updateLives() { const c = document.getElementById('lives-container'); c.innerHTML = ''; for(let i=0; i<3; i++) c.innerHTML += `<span class="text-xl ${i<lives?'':'opacity-20 grayscale'}">‚ù§Ô∏è</span>`; }
        function showUnitSelection() { document.getElementById('view-landing').classList.add('hidden'); document.getElementById('view-selection').classList.remove('hidden'); }

        function endGame() {
            clearInterval(timerId);
            const best = localStorage.getItem('grade12_best_score') || 0;
            if(score > best) { localStorage.setItem('grade12_best_score', score); document.getElementById('new-record-tag').classList.remove('hidden'); }
            
            let rank = "T√¢n binh üë∂";
            if(score > 1000) rank = "Huy·ªÅn tho·∫°i üåå";
            else if(score >= 501) rank = "B·∫≠c th·∫ßy t·ª´ v·ª±ng üíé";
            else if(score >= 201) rank = "Th·ª£ sƒÉn t·ª´ v·ª±ng üèπ";

            document.getElementById('rank-display').innerText = "Danh hi·ªáu: " + rank;
            document.getElementById('view-game').classList.add('hidden');
            document.getElementById('view-result').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
            document.getElementById('result-status').innerText = lives <= 0 ? "B·∫†N ƒê√É H·∫æT TIM!" : "H·∫æT GI·ªú!";
            if(score > 1000) triggerFireworks();
        }
    </script>
</body>
</html>
