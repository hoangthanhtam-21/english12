<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preposition Master - Lite Version</title>
    <!-- Tailwind CSS qua CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            margin: 0; 
            overflow-x: hidden;
            background-image: url('https://img.freepik.com/free-vector/flat-design-english-school-background_23-2149487419.jpg?w=2000');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
        }
        .hidden { display: none !important; }
        
        /* Lớp phủ để làm mờ hình nền và giúp nội dung nổi bật */
        #app {
            background: rgba(2, 6, 23, 0.75);
            backdrop-filter: blur(2px);
            min-height: 100vh;
        }

        .glow { box-shadow: 0 0 25px rgba(79, 70, 229, 0.5); }
        .card { 
            background: rgba(15, 23, 42, 0.9); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(255,255,255,0.15); 
            border-radius: 2rem; 
        }
        .btn-opt { 
            background: rgba(255,255,255,0.08); 
            border: 1px solid rgba(255,255,255,0.15); 
            padding: 1.25rem; 
            border-radius: 1rem; 
            transition: all 0.2s; 
            font-weight: 800; 
            font-size: 1.1rem; 
        }
        .btn-opt:hover { 
            background: white; 
            color: #4f46e5; 
            transform: scale(1.02); 
            border-color: white;
        }
        .animate-pop { animation: pop 0.3s ease-out; }
        @keyframes pop { 
            0% { transform: scale(0.8); opacity: 0; } 
            100% { transform: scale(1); opacity: 1; } 
        }
    </style>
</head>
<body>
    <div id="app" class="flex flex-col items-center justify-center p-6 relative">
        <!-- MÀN HÌNH CHÀO -->
        <div id="view-landing" class="relative z-10 text-center w-full max-w-md animate-pop">
            <div class="w-20 h-20 bg-indigo-600 rounded-[2rem] flex items-center justify-center mx-auto mb-8 glow">
                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path></svg>
            </div>
            <h1 class="text-4xl font-black mb-2 tracking-tighter uppercase italic drop-shadow-lg">Preposition Master</h1>
            <p class="text-indigo-300 text-[10px] font-black tracking-[0.3em] uppercase mb-12 drop-shadow">Unit 5 Urbanization • Lite Edition</p>
            <div class="space-y-4">
                <button onclick="startGame()" class="w-full bg-white text-indigo-700 py-5 rounded-2xl font-black text-lg hover:bg-indigo-500 hover:text-white transition-all shadow-2xl">CHƠI NGAY (7 PHÚT)</button>
            </div>
        </div>

        <!-- MÀN HÌNH CHƠI GAME -->
        <div id="view-game" class="relative z-10 w-full max-w-md hidden">
            <div class="flex justify-between items-center mb-6 bg-slate-900/90 p-5 rounded-2xl border border-white/10 shadow-xl">
                <div>
                    <p class="text-[10px] font-black text-indigo-400 uppercase tracking-widest">Thời gian</p>
                    <p id="timer" class="text-2xl font-black font-mono">07:00</p>
                </div>
                <div class="text-right">
                    <p class="text-[10px] font-black text-indigo-400 uppercase tracking-widest">Điểm số</p>
                    <p id="score" class="text-3xl font-black text-yellow-400">0</p>
                </div>
            </div>

            <div class="card min-h-[420px] flex flex-col items-center justify-center text-center p-8 relative overflow-hidden shadow-2xl">
                <div id="question-area" class="w-full animate-pop">
                    <div class="flex justify-center gap-1 mb-6" id="streak-dots">
                        <div class="h-1.5 w-8 rounded-full bg-white/10"></div>
                        <div class="h-1.5 w-8 rounded-full bg-white/10"></div>
                        <div class="h-1.5 w-8 rounded-full bg-white/10"></div>
                    </div>
                    <p class="text-indigo-400 text-[10px] font-black uppercase tracking-[0.2em] mb-4 underline decoration-2 underline-offset-4">Chọn giới từ đúng</p>
                    <h2 id="word-display" class="text-4xl font-black mb-3 tracking-tight">word...</h2>
                    <p id="meaning-display" class="text-slate-300 italic text-sm mb-12 font-medium"> (nghĩa) </p>
                    <div id="options-grid" class="grid grid-cols-2 gap-4 w-full"></div>
                </div>

                <!-- Hệ thống rương -->
                <div id="chest-area" class="hidden text-center">
                    <h3 class="text-2xl font-black text-yellow-400 mb-8 uppercase tracking-tighter">CHÍNH XÁC! NHẬN QUÀ</h3>
                    <div class="flex gap-4 justify-center" id="chest-selection">
                        <button onclick="openChest()" class="w-24 h-24 bg-indigo-600 rounded-3xl flex items-center justify-center hover:bg-yellow-500 transition-all hover:scale-110 shadow-xl border border-white/20">
                            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 12V8H4v4"></path><path d="M2 12h20"></path><path d="M20 12v8H4v-8"></path><circle cx="12" cy="12" r="2"></circle></svg>
                        </button>
                        <button onclick="openChest()" class="w-24 h-24 bg-indigo-600 rounded-3xl flex items-center justify-center hover:bg-yellow-500 transition-all hover:scale-110 shadow-xl border border-white/20">
                            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 12V8H4v4"></path><path d="M2 12h20"></path><path d="M20 12v8H4v-8"></path><circle cx="12" cy="12" r="2"></circle></svg>
                        </button>
                    </div>
                    <div id="chest-result" class="hidden mt-6 p-10 bg-indigo-600 rounded-[2rem] animate-pop border border-white/20">
                        <p id="bonus-text" class="text-4xl font-black text-white">+0đ</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- MÀN HÌNH KẾT QUẢ -->
        <div id="view-result" class="relative z-10 w-full max-w-md hidden animate-pop">
            <div class="text-center bg-slate-900/95 backdrop-blur-xl border border-white/10 p-12 rounded-[3rem] shadow-2xl">
                <div class="w-20 h-20 bg-yellow-500 rounded-full flex items-center justify-center mx-auto mb-6 shadow-yellow-500/30 shadow-2xl">
                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
                </div>
                <h2 class="text-3xl font-black mb-2 uppercase italic tracking-tighter text-white">KẾT THÚC!</h2>
                <div class="my-10">
                    <p class="text-indigo-400 text-[10px] font-black uppercase tracking-widest mb-1">Tổng điểm đạt được</p>
                    <p id="final-score" class="text-7xl font-black text-white tracking-tighter drop-shadow-lg">0</p>
                </div>
                <button onclick="location.reload()" class="w-full bg-white text-indigo-700 py-5 rounded-2xl font-black text-lg hover:bg-indigo-600 hover:text-white transition-all shadow-lg">CHƠI LẠI</button>
            </div>
        </div>
    </div>

    <script>
        const WORD_BANK = [
            { id: 1, word: "ban... ", prep: "from", meaning: "cấm làm điều gì đó" },
            { id: 2, word: "benefit ", prep: "from", meaning: "có lợi từ thứ gì đó" },
            { id: 3, word: "believe ", prep: "in", meaning: "tin vào" },
            { id: 4, word: "specialize ", prep: "in", meaning: "chuyên về" },
            { id: 5, word: "accuse... ", prep: "of", meaning: "buộc tội vì điều gì" },
            { id: 6, word: "remind... ", prep: "of", meaning: "nhắc nhở về điều gì" },
            { id: 7, word: "agree ", prep: "on", meaning: "đồng ý về điều gì" },
            { id: 8, word: "rely ", prep: "on", meaning: "dựa vào" },
            { id: 9, word: "belong ", prep: "to", meaning: "thuộc về" },
            { id: 10, word: "object ", prep: "to", meaning: "phản đối" },
            { id: 11, word: "satisfied ", prep: "with", meaning: "hài lòng với" },
            { id: 12, word: "famous ", prep: "for", meaning: "nổi tiếng về" },
            { id: 13, word: "proud ", prep: "of", meaning: "tự hào về" },
            { id: 14, word: "anxious ", prep: "about", meaning: "lo lắng về" },
            { id: 15, word: "succeed ", prep: "in", meaning: "thành công về điều gì" },
            { id: 16, word: "invest ", prep: "in", meaning: "đầu tư vào" },
            { id: 17, word: "result ", prep: "in", meaning: "dẫn đến kết quả" },
            { id: 18, word: "result ", prep: "from", meaning: "do bởi (nguyên nhân)" },
            { id: 19, word: "recover ", prep: "from", meaning: "hồi phục từ" },
            { id: 20, word: "prepare ", prep: "for", meaning: "chuẩn bị cho" },
            { id: 21, word: "wait ", prep: "for", meaning: "chờ đợi" },
            { id: 22, word: "concentrate ", prep: "on", meaning: "tập trung vào" },
            { id: 23, word: "insist ", prep: "on", meaning: "khăng khăng làm gì" },
            { id: 24, word: "congratulate... ", prep: "on", meaning: "chúc mừng ai vì điều gì" },
            { id: 25, word: "apologize... ", prep: "for", meaning: "xin lỗi về điều gì" },
            { id: 26, word: "capable ", prep: "of", meaning: "có khả năng làm gì" },
            { id: 27, word: "keen ", prep: "on", meaning: "say mê điều gì" },
            { id: 28, word: "accustomed ", prep: "to", meaning: "quen với" },
            { id: 29, word: "provide... ", prep: "with", meaning: "cung cấp cái gì cho ai" },
            { id: 30, word: "depend ", prep: "on", meaning: "phụ thuộc vào" },
            { id: 31, word: "base... ", prep: "on", meaning: "dựa trên" },
            { id: 32, word: "suffer ", prep: "from", meaning: "chịu đựng (bệnh tật)" },
            { id: 33, word: "translate... ", prep: "into", meaning: "dịch sang" },
            { id: 34, word: "divide... ", prep: "into", meaning: "chia thành" },
            { id: 35, word: "compare... ", prep: "with", meaning: "so sánh với" },
            { id: 36, word: "afraid ", prep: "of", meaning: "sợ hãi điều gì" },
            { id: 37, word: "interested ", prep: "in", meaning: "quan tâm đến" },
            { id: 38, word: "tired ", prep: "of", meaning: "mệt mỏi vì" },
            { id: 39, word: "worried ", prep: "about", meaning: "lo lắng về" },
            { id: 40, word: "similar ", prep: "to", meaning: "tương tự với" },
            { id: 41, word: "absent ", prep: "from", meaning: "vắng mặt khỏi" },
            { id: 42, word: "addicted ", prep: "to", meaning: "nghiện thứ gì" },
            { id: 43, word: "crowded ", prep: "with", meaning: "đông đúc với" },
            { id: 44, word: "engaged ", prep: "in", meaning: "tham gia vào / bận rộn" },
            { id: 45, word: "opposed ", prep: "to", meaning: "phản đối" },
            { id: 46, word: "aware ", prep: "of", meaning: "nhận thức về" },
            { id: 47, word: "full ", prep: "of", meaning: "đầy rẫy" },
            { id: 48, word: "good ", prep: "at", meaning: "giỏi về" },
            { id: 49, word: "bad ", prep: "at", meaning: "dở về" },
            { id: 50, word: "different ", prep: "from", meaning: "khác biệt với" },
            { id: 51, word: "excited ", prep: "about", meaning: "hào hứng về" },
            { id: 52, word: "ashamed ", prep: "of", meaning: "hổ thẹn về" },
            { id: 53, word: "bored ", prep: "with", meaning: "chán nản với" },
            { id: 54, word: "married ", prep: "to", meaning: "kết hôn với" },
            { id: 55, word: "responsible ", prep: "for", meaning: "chịu trách nhiệm cho" },
            { id: 56, word: "late ", prep: "for", meaning: "trễ giờ làm gì" },
            { id: 57, word: "safe ", prep: "from", meaning: "an toàn khỏi" },
            { id: 58, word: "terrified ", prep: "of", meaning: "khiếp sợ" },
            { id: 59, word: "useful ", prep: "for", meaning: "hữu ích cho" },
            { id: 60, word: "perfect ", prep: "for", meaning: "hoàn hảo cho" }
        ];

        const PREPS = ["from", "in", "of", "on", "to", "with", "for", "about", "at", "into"];
        
        let score = 0;
        let timeLeft = 420;
        let currentQ = null;
        let timerId = null;
        let streak = 0;

        function startGame() {
            document.getElementById('view-landing').classList.add('hidden');
            document.getElementById('view-game').classList.remove('hidden');
            score = 0;
            timeLeft = 420;
            streak = 0;
            updateScore();
            nextQuestion();
            timerId = setInterval(() => {
                timeLeft--;
                const m = Math.floor(timeLeft/60);
                const s = timeLeft%60;
                document.getElementById('timer').innerText = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                if(timeLeft <= 0) endGame();
            }, 1000);
        }

        function nextQuestion() {
            document.getElementById('question-area').classList.remove('hidden');
            document.getElementById('chest-area').classList.add('hidden');
            document.getElementById('chest-selection').classList.remove('hidden');
            document.getElementById('chest-result').classList.add('hidden');

            currentQ = WORD_BANK[Math.floor(Math.random() * WORD_BANK.length)];
            document.getElementById('word-display').innerText = currentQ.word;
            document.getElementById('meaning-display').innerText = `(${currentQ.meaning})`;

            const opts = [currentQ.prep];
            while(opts.length < 4) {
                const r = PREPS[Math.floor(Math.random() * PREPS.length)];
                if(!opts.includes(r)) opts.push(r);
            }
            opts.sort(() => Math.random() - 0.5);

            const grid = document.getElementById('options-grid');
            grid.innerHTML = '';
            opts.forEach(o => {
                const b = document.createElement('button');
                b.className = 'btn-opt';
                b.innerText = o;
                b.onclick = () => check(o);
                grid.appendChild(b);
            });

            const dots = document.getElementById('streak-dots').children;
            for(let i=0; i<3; i++) {
                dots[i].className = `h-1.5 w-8 rounded-full transition-all ${i < streak ? 'bg-green-400 shadow-[0_0_10px_#4ade80]' : 'bg-white/10'}`;
            }
        }

        function check(ans) {
            if(ans === currentQ.prep) {
                streak++;
                score += 5;
                if(streak >= 3) {
                    streak = 0;
                    showChest();
                } else {
                    nextQuestion();
                }
            } else {
                streak = 0;
                score = Math.max(0, score - 2);
                document.getElementById('question-area').classList.add('animate-pulse');
                setTimeout(() => {
                    document.getElementById('question-area').classList.remove('animate-pulse');
                    nextQuestion();
                }, 400);
            }
            updateScore();
        }

        function showChest() {
            document.getElementById('question-area').classList.add('hidden');
            document.getElementById('chest-area').classList.remove('hidden');
        }

        function openChest() {
            const bonus = Math.floor(Math.random() * 20) + 10;
            score += bonus;
            updateScore();
            document.getElementById('chest-selection').classList.add('hidden');
            document.getElementById('chest-result').classList.remove('hidden');
            document.getElementById('bonus-text').innerText = `+${bonus} ĐIỂM!`;
            setTimeout(nextQuestion, 1500);
        }

        function updateScore() {
            document.getElementById('score').innerText = score;
        }

        function endGame() {
            clearInterval(timerId);
            document.getElementById('view-game').classList.add('hidden');
            document.getElementById('view-result').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
        }
    </script>
</body>
</html>
