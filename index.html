<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Học Tiếng Anh Lớp 12 - Unit 5: Prepositions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .card { transition: all 0.3s ease; }
        .correct { background-color: #10b981 !important; color: white; }
        .incorrect { background-color: #ef4444 !important; color: white; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-2xl mx-auto">
        <div class="bg-white rounded-xl shadow-md p-6 mb-6">
            <h1 class="text-2xl font-bold text-blue-600 text-center mb-2">LUYỆN TẬP GIỚI TỪ - UNIT 5</h1>
            <div class="flex justify-between items-center text-lg font-semibold">
                <div class="text-gray-600">Thời gian: <span id="timer" class="text-red-500">10:00</span></div>
                <div class="text-gray-600">Điểm: <span id="score" class="text-green-600">0</span></div>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2.5 mt-4">
                <div id="progress" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
            </div>
            <p class="text-xs text-gray-400 mt-2 text-center text-italic text-sm">* Trả lời đúng 3 lần để hoàn thành 1 từ</p>
        </div>

        <div id="game-container" class="bg-white rounded-xl shadow-lg p-8 card">
            <div id="question-box" class="text-center">
                <p class="text-gray-500 text-sm mb-1">Chọn giới từ phù hợp cho:</p>
                <h2 id="word-display" class="text-3xl font-bold mb-2 text-gray-800">...</h2>
                <p id="meaning-display" class="text-lg text-blue-500 italic mb-8">...</p>
                
                <div id="options-grid" class="grid grid-cols-2 gap-4">
                    </div>
            </div>
        </div>

        <div id="result-screen" class="hidden bg-white rounded-xl shadow-lg p-8 text-center">
            <h2 class="text-3xl font-bold mb-4">Hết giờ!</h2>
            <p class="text-xl mb-6">Tổng điểm của bạn là: <span id="final-score" class="font-bold text-blue-600 text-4xl">0</span></p>
            <button onclick="location.reload()" class="bg-blue-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-blue-700 transition">Chơi lại</button>
        </div>
    </div>

    <script>
        // Ngân hàng từ vựng trích xuất từ ảnh bạn gửi
        const wordBank = [
            { word: "ban... ", prep: "from", meaning: "cấm làm điều gì đó" },
            { word: "benefit ", prep: "from", meaning: "có lợi từ thứ gì đó" },
            { word: "believe ", prep: "in", meaning: "tin vào" },
            { word: "specialize ", prep: "in", meaning: "chuyên về" },
            { word: "accuse... ", prep: "of", meaning: "buộc tội vì điều gì" },
            { word: "remind... ", prep: "of", meaning: "nhắc nhở về điều gì" },
            { word: "agree ", prep: "on", meaning: "đồng ý về điều gì" },
            { word: "rely ", prep: "on", meaning: "dựa vào" },
            { word: "belong ", prep: "to", meaning: "thuộc về" },
            { word: "object ", prep: "to", meaning: "phản đối" },
            { word: "angry ", prep: "with", meaning: "tức giận với ai" },
            { word: "satisfied ", prep: "with", meaning: "hài lòng với" },
            { word: "famous ", prep: "for", meaning: "nổi tiếng về" },
            { word: "apply ", prep: "for", meaning: "nộp đơn xin (việc...)" },
            { word: "proud ", prep: "of", meaning: "tự hào về" },
            { word: "anxious ", prep: "about", meaning: "lo lắng về" },
            { word: "succeed ", prep: "in", meaning: "thành công về điều gì" },
            { word: "protect... ", prep: "against", meaning: "bảo vệ khỏi điều gì" },
            { word: "good ", prep: "at", meaning: "giỏi về việc gì" },
            { word: "by ", prep: "accident", meaning: "tình cờ, ngẫu nhiên" },
            { word: "at ", prep: "once", meaning: "ngay lập tức" },
            { word: "solution ", prep: "to", meaning: "giải pháp cho" },
            { word: "independent ", prep: "of", meaning: "độc lập, không lệ thuộc" },
            { word: "look forward ", prep: "to", meaning: "mong đợi điều gì đó" },
            { word: "prevent... ", prep: "from", meaning: "ngăn cản khỏi điều gì" }
        ];

        const prepositions = ["from", "in", "of", "on", "to", "with", "for", "about", "at", "against"];
        
        let score = 0;
        let timeLeft = 600; // 10 phút
        let activeWords = []; // 20 từ đang luyện tập
        let currentWord = null;
        let gameActive = true;

        // Khởi tạo game
        function initGame() {
            // Lấy ngẫu nhiên 20 từ từ ngân hàng từ
            let shuffled = [...wordBank].sort(() => 0.5 - Math.random());
            activeWords = shuffled.slice(0, 20).map(item => ({...item, count: 0}));
            
            updateScore();
            nextQuestion();
            startTimer();
        }

        function nextQuestion() {
            if (!gameActive) return;

            // Chọn ngẫu nhiên 1 từ trong 20 từ đang active
            currentWord = activeWords[Math.floor(Math.random() * activeWords.length)];
            
            document.getElementById('word-display').innerText = currentWord.word;
            document.getElementById('meaning-display').innerText = `(${currentWord.meaning})`;
            
            generateOptions(currentWord.prep);
        }

        function generateOptions(correctPrep) {
            const grid = document.getElementById('options-grid');
            grid.innerHTML = '';
            
            // Lấy 3 giới từ sai ngẫu nhiên
            let others = prepositions.filter(p => p !== correctPrep);
            let selectedOthers = others.sort(() => 0.5 - Math.random()).slice(0, 3);
            
            let choices = [...selectedOthers, correctPrep].sort(() => 0.5 - Math.random());
            
            choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = "py-4 text-xl font-semibold border-2 border-gray-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition card";
                btn.innerText = choice;
                btn.onclick = () => checkAnswer(choice, btn);
                grid.appendChild(btn);
            });
        }

        function checkAnswer(choice, btn) {
            if (!gameActive) return;

            if (choice === currentWord.prep) {
                score += 2;
                currentWord.count += 1;
                btn.classList.add('correct');
                
                // Nếu đúng 3 lần, đổi từ mới
                if (currentWord.count >= 3) {
                    replaceWord(currentWord);
                }
            } else {
                score = Math.max(0, score - 1);
                currentWord.count = 0; // Reset count nếu trả lời sai
                btn.classList.add('incorrect');
            }

            updateScore();
            setTimeout(nextQuestion, 600);
        }

        function replaceWord(wordToReplace) {
            const index = activeWords.indexOf(wordToReplace);
            // Tìm từ trong ngân hàng từ chưa có trong activeWords
            const currentActiveWordsText = activeWords.map(w => w.word);
            const availableWords = wordBank.filter(w => !currentActiveWordsText.includes(w.word));
            
            if (availableWords.length > 0) {
                const newWord = availableWords[Math.floor(Math.random() * availableWords.length)];
                activeWords[index] = {...newWord, count: 0};
            }
        }

        function updateScore() {
            document.getElementById('score').innerText = score;
            // Tiến độ trung bình của 20 từ (mỗi từ tối đa 3 điểm)
            let totalProgress = activeWords.reduce((sum, w) => sum + w.count, 0);
            let progressPercent = (totalProgress / 60) * 100;
            document.getElementById('progress').style.width = progressPercent + "%";
        }

        function startTimer() {
            const timerDisplay = document.getElementById('timer');
            const interval = setInterval(() => {
                let mins = Math.floor(timeLeft / 60);
                let secs = timeLeft % 60;
                timerDisplay.innerText = `${mins}:${secs < 10 ? '0' : ''}${secs}`;
                
                if (timeLeft <= 0) {
                    clearInterval(interval);
                    endGame();
                }
                timeLeft--;
            }, 1000);
        }

        function endGame() {
            gameActive = false;
            document.getElementById('game-container').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
        }

        initGame();
    </script>
</body>
</html>
